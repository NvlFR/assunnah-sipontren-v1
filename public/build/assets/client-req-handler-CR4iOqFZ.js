import{c as C,h as B,v as D,s as P,a as I,f as w,N as y,Q as _,b as q,D as k}from"./index-kFhORbdG.js";import{r as A,o as V,a as j,b as K,g as O,h as Q,n as R,p as N}from"./vendor1-aBnGFKd0.js";const G=C({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(r,{slots:i,emit:o}){const d=O(),u=A(null);let t=0;const n=[];function s(e){const m=typeof e=="boolean"?e:r.noErrorFocus!==!0,p=++t,S=(a,c)=>{o(`validation${a===!0?"Success":"Error"}`,c)},x=a=>{const c=a.validate();return typeof c.then=="function"?c.then(f=>({valid:f,comp:a}),f=>({valid:!1,comp:a,err:f})):Promise.resolve({valid:c,comp:a})};return(r.greedy===!0?Promise.all(n.map(x)).then(a=>a.filter(c=>c.valid!==!0)):n.reduce((a,c)=>a.then(()=>x(c).then(f=>{if(f.valid===!1)return Promise.reject(f)})),Promise.resolve()).catch(a=>[a])).then(a=>{if(a===void 0||a.length===0)return p===t&&S(!0),!0;if(p===t){const{comp:c,err:f}=a[0];if(f!==void 0&&console.error(f),S(!1,c),m===!0){const E=a.find(({comp:F})=>typeof F.focus=="function"&&D(F.$)===!1);E!==void 0&&E.comp.focus()}}return!1})}function g(){t++,n.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function l(e){e!==void 0&&P(e);const m=t+1;s().then(p=>{m===t&&p===!0&&(r.onSubmit!==void 0?o("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function h(e){e!==void 0&&P(e),o("reset"),R(()=>{g(),r.autofocus===!0&&r.noResetFocus!==!0&&v()})}function v(){I(()=>{if(u.value===null)return;const e=u.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||u.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||u.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(u.value.querySelectorAll("[tabindex]"),m=>m.tabIndex!==-1);e!=null&&e.focus({preventScroll:!0})})}N(w,{bindComponent(e){n.push(e)},unbindComponent(e){const m=n.indexOf(e);m!==-1&&n.splice(m,1)}});let b=!1;return V(()=>{b=!0}),j(()=>{b===!0&&r.autofocus===!0&&v()}),K(()=>{r.autofocus===!0&&v()}),Object.assign(d.proxy,{validate:s,resetValidation:g,submit:l,reset:h,focus:v,getValidationComponents:()=>n}),()=>Q("form",{class:"q-form",ref:u,onSubmit:l,onReset:h},B(i.default))}}),T=()=>{const r=_();Object.keys(r.props.errors)[0]&&setTimeout(()=>{const o=document.querySelector(".q-field--error input");o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.focus())},0)};function H(r){const{form:i,url:o,onSuccess:d,onError:u,method:t,forceFormData:n}=r;i.clearErrors(),i[t??"post"](o,{preserveScroll:!0,forceFormData:n??!1,onSuccess:s=>{typeof d=="function"&&d(s)},onError:s=>{var g,l;typeof u=="function"&&u(s),T(),!(!s||typeof((g=s.response)==null?void 0:g.data)=="object"||s.message===void 0||((l=s.message)==null?void 0:l.length)===0)&&y.create({message:s.message,icon:"info",color:"negative",actions:[{icon:"close",color:"white",round:!0,dense:!0}]})}})}function J(r){const{message:i,url:o,fetchItemsCallback:d,loading:u}=r;k.create({title:"Konfirmasi",icon:"question",message:i,focus:"cancel",cancel:!0,persistent:!0}).onOk(()=>{u.value=!0,q.post(o).then(t=>{y.create(t.data.message),d()}).finally(()=>{u.value=!1}).catch(t=>{let n="";t.response.data&&t.response.data.message?n=t.response.data.message:t.message&&(n=t.message),n.length>0&&y.create({message:n,color:"red"}),console.log(t)})})}function L(r){const{pagination:i,props:o,rows:d,url:u,loading:t,filter:n}=r;let s=o?o.pagination:i.value,g={page:s.page,per_page:s.rowsPerPage,order_by:s.sortBy,order_type:s.descending?"desc":"asc",filter:n};t.value=!0,q.get(u,{params:g}).then(l=>{d.value=l.data.data,i.value.page=l.data.current_page,i.value.rowsPerPage=l.data.per_page,i.value.rowsNumber=l.data.total,o&&(i.value.sortBy=o.pagination.sortBy,i.value.descending=o.pagination.descending)}).finally(()=>{t.value=!1})}export{G as Q,L as a,J as b,H as h};
